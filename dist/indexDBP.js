!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("indexDBP",[],t):"object"==typeof exports?exports.indexDBP=t():e.indexDBP=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var s=t[o](i),l=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(l).then(function(e){r("next",e)},function(e){r("throw",e)});e(l)}("next")})}}n.r(t);const o={onError:function(e){throw e}},i={autoIncrement:!0,keyPath:"id"},s={upsert:!1,multi:!1,extend:!0},l={version:"0.1.0",description:"nothing to say"},u=["webkit","moz","ms","shim"];const c=function(){let e=window.indexedDB;return e||u.forEach(t=>{let n=window[t+"IndexedDB"];n&&(e=n)}),e}(),a={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"};function d(e,t){e.$db[t]={insert:e.insert.bind(e,t),update:e.update.bind(e,t),remove:e.remove.bind(e,t),find:e.find.bind(e,t),createIndex:e.createIndex.bind(e,t),deleteIndex:e.deleteIndex.bind(e,t),containIndex:e.containIndex.bind(e,t)}}function f(e){e.$db={}}class h{constructor(e={}){for(let t in o)this[t]=void 0!==e[t]?e[t]:o[t];this.Version=l.version,function(e){f(e);let t=null;Object.defineProperty(e,"db",{get(){if(null===t)throw new Error("db is not used, use(DBName) before any operaion");return t},set(n){if(t=n,null!==n){let n=t.objectStoreNames;for(let t=0;t<n.length;t++)d(e,n[t])}else f(e)}})}(this),this.isVersionChange=!1,this.openRequest=null,this.versionTransaction=null}getTransaction(e,t){return this.db.transaction(e,t)}getObjectStore(e,t){return this.getTransaction(e,t).objectStore(e)}use(e,t){return new Promise((n,r)=>{let o=c.open(e,t);this.openRequest=o,o.onerror=(e=>{if(this.db=null,this.isVersionChange=!1,this.versionTransaction=null,function(e){if("error"in e.target)return"VersionError"===e.target.error.name;if("errorCode"in e.target)return 12===e.target.errorCode;return!1}(e))r(p.call(this,"The version number provided is lower than the existing one."));else{let t;if(e.target.error)t=(t=e.target.error).message||t;else{let n="IndexedDB unknown error occurred when opening DB "+this.dbName+" version "+this.dbVersion;"errorCode"in e.target&&(n+=" with error code "+e.target.errorCode),t=new Error(n)}r(p.call(this,t))}}),o.onsuccess=(e=>{this.db=e.target.result,this.isVersionChange=!1,this.versionTransaction=null,n(!0)}),o.onupgradeneeded=(e=>{this.db=e.target.result,this.isVersionChange=!0,this.versionTransaction=e.target.transaction,n(!0)})})}dropDatabase(){return new Promise((e,t)=>{if(c.deleteDatabase){let r=this.db.name;g.call(this);var n=c.deleteDatabase(r);n.onsuccess=(t=>{e(t)}),n.onerror=(e=>{t(p.call(this,e))})}else t(p.call(this,"Browser does not support IndexedDB deleteDatabase!"))})}containCollection(e){return y(this.db.objectStoreNames,e)>-1}createCollection(e,t){var n=this;return r(function*(){if(t=Object.assign({},i,t),n.containCollection(e))return p.call(n,`collection: ${e} exist`);yield m.call(n,"versionChange");let r=n.db.createObjectStore(e,t);return d(n,e),r})()}containIndex(e,t){let n;return y((n=this.versionTransaction?this.versionTransaction:this.getTransaction(e,a.READ_ONLY)).objectStore(e).indexNames,t)>-1}createIndex(e,t,n,o){var i=this;return r(function*(){return yield m.call(i,"versionChange"),i.versionTransaction.objectStore(e).createIndex(t,n,o),!0})()}deleteIndex(e,t){var n=this;return r(function*(){return yield m.call(n,"versionChange"),n.versionTransaction.objectStore(e).deleteIndex(t),!0})()}deleteCollection(e){var t=this;return r(function*(){return t.containCollection(e)?(yield m.call(t,"versionChange"),t.db.deleteObjectStore(e),!0):p.call(t,`collection: ${e} not exist`)})()}insert(e,t,n={}){var o=this;return r(function*(){return yield m.call(o,"normal"),new Promise(function(r,i){let s=o.getObjectStore(e,a.READ_WRITE).add(t,n.key);v.call(o,s,i,"add IDBRequest unknown error"),s.onsuccess=function(e){r(e)}})})()}update(e,t,n,o){var i=this;return r(function*(){o=Object.assign({},s,o),yield m.call(i,"normal");let r=yield i.find(e,t);const l=function(t){return new Promise(function(r,s){let l=i.getObjectStore(e,a.READ_WRITE);t[l.keyPath]&&(n[l.keyPath]=t[l.keyPath]),o.extend&&(n=Object.assign(t,n));let u=l.put(n);v.call(i,u,s,"update IDBRequest unknown error"),u.onsuccess=function(e){r(e)}})};if(o.multi)return Promise.all(r.map(function(e){return l(e)}));return r.length||o.upsert?l(r[0]||{}):p.call(i,"can not find result!")})()}remove(e,t){var n=this;return r(function*(){const r="[object Object]"===Object.prototype.toString.call(t);return yield m.call(n,"normal"),new Promise(function(o,i){let s=n.getObjectStore(e,a.READ_WRITE),l=t;r&&(l=b(t));let u=s.delete(l);v.call(n,u,i,"remove IDBRequest unknown error"),u.onsuccess=function(e){o(e)}})})()}find(e,t,n){var o=this;return r(function*(){const r="[object Object]"===Object.prototype.toString.call(t);return yield m.call(o,"normal"),new Promise(function(i,s){let l,u=o.getObjectStore(e,a.READ_ONLY),c=u;if(n){c=u.index(n)}if(r){let e=b(t);l=c.getAll(e,t.count)}else l=c.getAll(t);v.call(o,l,s,"find IDBRequest unknown error"),l.onsuccess=function(e){i(l.result)}})})()}}function b(e){let t=Object.keys(e);const n=t.indexOf("$lt")>-1||t.indexOf("$lte")>-1,r=t.indexOf("$gt")>-1||t.indexOf("$gte")>-1;return n&&r?IDBKeyRange.bound(e.$gt||e.$gte,e.$lt||e.$lte,!!e.$gt,!!e.$lt):r?IDBKeyRange.lowerBound(e.$gt||e.$gte,!!e.$gt):n?IDBKeyRange.upperBound(e.$lt||e.$lte,e.$lt):e.value||""}function g(){this.db.close(),this.db=null,this.openRequest.onerror=null,this.openRequest.onsuccess=null,this.openRequest.onupgradeneeded=null,this.openRequest=null}function p(e){let t;return t=e instanceof Error?e:new Error(e),this.onError(t),t}function v(e,t,n){e.onerror=(e=>{let r=e.target.error;t(p.call(this,r.message||n))})}function m(e){var t=this;const n=(o=r(function*(e){let n=t.db.name,r=e?t.db.version+1:t.db.version;g.call(t),yield t.use(n,r)}),function(e){return o.apply(this,arguments)});var o;return"versionChange"===e?this.isVersionChange?Promise.resolve(!0):n(!0):"normal"===e?this.isVersionChange?n(!1):Promise.resolve(!0):void 0}function y(e,t){let n=-1;for(let r=0;r<e.length;r++)e[r]===t&&(n=r);return n}h.Version=l.version;"object"!=typeof window&&console.error("only used in browsers"),"undefined"==typeof Promise&&console.error("Promise Api is needed"),t.default=h}])});